{"version":3,"file":"cash-app-pay.es.mjs","sources":["../../../src/components/cash-app-pay/cash-app-pay.tsx"],"sourcesContent":["// Dependencies\r\nimport React from 'react';\r\nimport { useState, useMemo, useEffect } from 'react';\r\nimport type * as Square from '@square/web-sdk';\r\n\r\n// Internals\r\nimport { useForm } from '~/contexts/form';\r\nimport type { CashAppPayProps } from './cash-app-pay.types';\r\n\r\nfunction CashAppPay({\r\n  callbacks,\r\n  id = 'rswps-cash-app-pay',\r\n  redirectURL,\r\n  referenceId,\r\n  shape = 'round',\r\n  size = 'medium',\r\n  values = 'dark',\r\n  width = 'static',\r\n  ...props\r\n}: CashAppPayProps) {\r\n  const [cashApp, setCashApp] = useState<Square.CashAppPay>();\r\n  const { createPaymentRequest, payments } = useForm();\r\n\r\n  const paymentRequestOptions: Square.CashAppPaymentRequestOptions = useMemo(\r\n    () => ({\r\n      redirectURL: redirectURL || window.location.href,\r\n      referenceId,\r\n    }),\r\n    [redirectURL, referenceId]\r\n  );\r\n\r\n  const options: Square.CashAppPayButtonOptions = useMemo(() => {\r\n    const baseOptions = {\r\n      shape,\r\n      size,\r\n      values,\r\n      width,\r\n    };\r\n\r\n    // if a value from options is undefined delete it from the options object\r\n    return Object.keys(baseOptions).reduce((acc: Record<string, unknown>, key) => {\r\n      if (baseOptions[key as keyof typeof baseOptions] !== undefined) {\r\n        acc[key as string] = baseOptions[key as keyof typeof baseOptions];\r\n      }\r\n\r\n      return acc;\r\n    }, {});\r\n  }, [shape, size, values, width]);\r\n\r\n  useEffect(() => {\r\n    if (!createPaymentRequest) {\r\n      throw new Error('`createPaymentRequest()` is required when using digital wallets');\r\n    }\r\n\r\n    const abortController = new AbortController();\r\n    const { signal } = abortController;\r\n    let cashApp: Square.CashAppPay | undefined;\r\n\r\n    const start = async (signal: AbortSignal) => {\r\n      const paymentRequest = payments?.paymentRequest(createPaymentRequest);\r\n\r\n      if (!paymentRequest) {\r\n        throw new Error('`paymentRequest` is required when using digital wallets');\r\n      }\r\n\r\n      try {\r\n        cashApp = await payments?.cashAppPay(paymentRequest, paymentRequestOptions).then((res) => {\r\n          if (signal?.aborted) {\r\n            return;\r\n          }\r\n\r\n          setCashApp(res);\r\n\r\n          return res;\r\n        });\r\n\r\n        await cashApp?.attach(`#${id}`, options);\r\n      } catch (error) {\r\n        console.error('Initializing Cash App Pay failed', error);\r\n      }\r\n    };\r\n\r\n    start(signal);\r\n\r\n    return () => {\r\n      abortController.abort();\r\n      cashApp?.destroy();\r\n    };\r\n  }, [createPaymentRequest, options, paymentRequestOptions, payments]);\r\n\r\n  if (callbacks) {\r\n    for (const callback of Object.keys(callbacks)) {\r\n      cashApp?.addEventListener(\r\n        callback.toLowerCase() as 'ontokenization',\r\n        (callbacks as Record<string, (event: Square.SqEvent<Square.CashAppPayEventData>) => void>)[callback]\r\n      );\r\n    }\r\n  }\r\n\r\n  return <div {...props} id={id} />;\r\n}\r\n\r\nexport default CashAppPay;\r\nexport * from './cash-app-pay.types';\r\n"],"names":["CashAppPay","callbacks","id","redirectURL","referenceId","shape","size","values","width","props","cashApp","setCashApp","useState","createPaymentRequest","payments","useForm","paymentRequestOptions","useMemo","options","baseOptions","acc","key","useEffect","abortController","signal","paymentRequest","res","error","callback","React"],"mappings":";;AASA,SAASA,EAAW;AAAA,EAClB,WAAAC;AAAA,EACA,IAAAC,IAAK;AAAA,EACL,aAAAC;AAAA,EACA,aAAAC;AAAA,EACA,OAAAC,IAAQ;AAAA,EACR,MAAAC,IAAO;AAAA,EACP,QAAAC,IAAS;AAAA,EACT,OAAAC,IAAQ;AAAA,EACR,GAAGC;AACL,GAAoB;AAClB,QAAM,CAACC,GAASC,CAAU,IAAIC,EAA4B,GACpD,EAAE,sBAAAC,GAAsB,UAAAC,EAAS,IAAIC,EAAQ,GAE7CC,IAA6DC;AAAA,IACjE,OAAO;AAAA,MACL,aAAad,KAAe,OAAO,SAAS;AAAA,MAC5C,aAAAC;AAAA,IAAA;AAAA,IAEF,CAACD,GAAaC,CAAW;AAAA,EAC3B,GAEMc,IAA0CD,EAAQ,MAAM;AAC5D,UAAME,IAAc;AAAA,MAClB,OAAAd;AAAA,MACA,MAAAC;AAAA,MACA,QAAAC;AAAA,MACA,OAAAC;AAAA,IACF;AAGA,WAAO,OAAO,KAAKW,CAAW,EAAE,OAAO,CAACC,GAA8BC,OAChEF,EAAYE,CAA+B,MAAM,WAC/CD,EAAAC,CAAa,IAAIF,EAAYE,CAA+B,IAG3DD,IACN,EAAE;AAAA,KACJ,CAACf,GAAOC,GAAMC,GAAQC,CAAK,CAAC;AA2C/B,MAzCAc,EAAU,MAAM;AACd,QAAI,CAACT;AACG,YAAA,IAAI,MAAM,iEAAiE;AAG7E,UAAAU,IAAkB,IAAI,gBAAgB,GACtC,EAAE,QAAAC,MAAWD;AACfb,QAAAA;AA0BJ,YAxBc,OAAOc,MAAwB;AACrC,YAAAC,IAAiBX,GAAU,eAAeD,CAAoB;AAEpE,UAAI,CAACY;AACG,cAAA,IAAI,MAAM,yDAAyD;AAGvE,UAAA;AACFf,QAAAA,IAAU,MAAMI,GAAU,WAAWW,GAAgBT,CAAqB,EAAE,KAAK,CAACU,MAAQ;AACxF,cAAIF,CAAAA,GAAQ;AAIZ,mBAAAb,EAAWe,CAAG,GAEPA;AAAA,QAAA,CACR,GAED,MAAMhB,GAAS,OAAO,IAAIR,CAAE,IAAIgB,CAAO;AAAA,eAChCS,GAAO;AACN,gBAAA,MAAM,oCAAoCA,CAAK;AAAA,MAAA;AAAA,IAE3D,GAEMH,CAAM,GAEL,MAAM;AACX,MAAAD,EAAgB,MAAM,GACtBb,GAAS,QAAQ;AAAA,IACnB;AAAA,KACC,CAACG,GAAsBK,GAASF,GAAuBF,CAAQ,CAAC,GAE/Db;AACF,eAAW2B,KAAY,OAAO,KAAK3B,CAAS;AACjC,MAAAS,GAAA;AAAA,QACPkB,EAAS,YAAY;AAAA,QACpB3B,EAA0F2B,CAAQ;AAAA,MACrG;AAIJ,SAAQC,gBAAAA,EAAA,cAAA,OAAA,EAAK,GAAGpB,GAAO,IAAAP,GAAQ;AACjC;"}