{"version":3,"file":"cash-app-pay.cjs.js","sources":["../../../src/components/cash-app-pay/cash-app-pay.tsx"],"sourcesContent":["// Dependencies\r\nimport React from 'react';\r\nimport { useState, useMemo, useEffect } from 'react';\r\nimport type * as Square from '@square/web-sdk';\r\n\r\n// Internals\r\nimport { useForm } from '~/contexts/form';\r\nimport type { CashAppPayProps } from './cash-app-pay.types';\r\n\r\nfunction CashAppPay({\r\n  callbacks,\r\n  id = 'rswps-cash-app-pay',\r\n  redirectURL,\r\n  referenceId,\r\n  shape = 'round',\r\n  size = 'medium',\r\n  values = 'dark',\r\n  width = 'static',\r\n  ...props\r\n}: CashAppPayProps) {\r\n  const [cashApp, setCashApp] = useState<Square.CashAppPay>();\r\n  const { createPaymentRequest, payments } = useForm();\r\n\r\n  const paymentRequestOptions: Square.CashAppPaymentRequestOptions = useMemo(\r\n    () => ({\r\n      redirectURL: redirectURL || window.location.href,\r\n      referenceId,\r\n    }),\r\n    [redirectURL, referenceId]\r\n  );\r\n\r\n  const options: Square.CashAppPayButtonOptions = useMemo(() => {\r\n    const baseOptions = {\r\n      shape,\r\n      size,\r\n      values,\r\n      width,\r\n    };\r\n\r\n    // if a value from options is undefined delete it from the options object\r\n    return Object.keys(baseOptions).reduce((acc: Record<string, unknown>, key) => {\r\n      if (baseOptions[key as keyof typeof baseOptions] !== undefined) {\r\n        acc[key as string] = baseOptions[key as keyof typeof baseOptions];\r\n      }\r\n\r\n      return acc;\r\n    }, {});\r\n  }, [shape, size, values, width]);\r\n\r\n  useEffect(() => {\r\n    if (!createPaymentRequest) {\r\n      throw new Error('`createPaymentRequest()` is required when using digital wallets');\r\n    }\r\n\r\n    const abortController = new AbortController();\r\n    const { signal } = abortController;\r\n    let cashApp: Square.CashAppPay | undefined;\r\n\r\n    const start = async (signal: AbortSignal) => {\r\n      const paymentRequest = payments?.paymentRequest(createPaymentRequest);\r\n\r\n      if (!paymentRequest) {\r\n        throw new Error('`paymentRequest` is required when using digital wallets');\r\n      }\r\n\r\n      try {\r\n        cashApp = await payments?.cashAppPay(paymentRequest, paymentRequestOptions).then((res) => {\r\n          if (signal?.aborted) {\r\n            return;\r\n          }\r\n\r\n          setCashApp(res);\r\n\r\n          return res;\r\n        });\r\n\r\n        await cashApp?.attach(`#${id}`, options);\r\n      } catch (error) {\r\n        console.error('Initializing Cash App Pay failed', error);\r\n      }\r\n    };\r\n\r\n    start(signal);\r\n\r\n    return () => {\r\n      abortController.abort();\r\n      cashApp?.destroy();\r\n    };\r\n  }, [createPaymentRequest, options, paymentRequestOptions, payments]);\r\n\r\n  if (callbacks) {\r\n    for (const callback of Object.keys(callbacks)) {\r\n      cashApp?.addEventListener(\r\n        callback.toLowerCase() as 'ontokenization',\r\n        (callbacks as Record<string, (event: Square.SqEvent<Square.CashAppPayEventData>) => void>)[callback]\r\n      );\r\n    }\r\n  }\r\n\r\n  return <div {...props} id={id} />;\r\n}\r\n\r\nexport default CashAppPay;\r\nexport * from './cash-app-pay.types';\r\n"],"names":["CashAppPay","callbacks","id","redirectURL","referenceId","shape","size","values","width","props","cashApp","setCashApp","useState","createPaymentRequest","payments","useForm","paymentRequestOptions","useMemo","options","baseOptions","acc","key","useEffect","abortController","signal","paymentRequest","res","error","callback","React"],"mappings":"kLASA,SAASA,EAAW,CAClB,UAAAC,EACA,GAAAC,EAAK,qBACL,YAAAC,EACA,YAAAC,EACA,MAAAC,EAAQ,QACR,KAAAC,EAAO,SACP,OAAAC,EAAS,OACT,MAAAC,EAAQ,SACR,GAAGC,CACL,EAAoB,CAClB,KAAM,CAACC,EAASC,CAAU,EAAIC,WAA4B,EACpD,CAAE,qBAAAC,EAAsB,SAAAC,CAAS,EAAIC,UAAQ,EAE7CC,EAA6DC,EAAA,QACjE,KAAO,CACL,YAAad,GAAe,OAAO,SAAS,KAC5C,YAAAC,CAAA,GAEF,CAACD,EAAaC,CAAW,CAC3B,EAEMc,EAA0CD,EAAAA,QAAQ,IAAM,CAC5D,MAAME,EAAc,CAClB,MAAAd,EACA,KAAAC,EACA,OAAAC,EACA,MAAAC,CACF,EAGA,OAAO,OAAO,KAAKW,CAAW,EAAE,OAAO,CAACC,EAA8BC,KAChEF,EAAYE,CAA+B,IAAM,SAC/CD,EAAAC,CAAa,EAAIF,EAAYE,CAA+B,GAG3DD,GACN,EAAE,GACJ,CAACf,EAAOC,EAAMC,EAAQC,CAAK,CAAC,EA2C/B,GAzCAc,EAAAA,UAAU,IAAM,CACd,GAAI,CAACT,EACG,MAAA,IAAI,MAAM,iEAAiE,EAG7E,MAAAU,EAAkB,IAAI,gBACtB,CAAE,OAAAC,GAAWD,EACfb,IAAAA,EA0BJ,OAxBc,MAAOc,GAAwB,CACrC,MAAAC,EAAiBX,GAAU,eAAeD,CAAoB,EAEpE,GAAI,CAACY,EACG,MAAA,IAAI,MAAM,yDAAyD,EAGvE,GAAA,CACFf,EAAU,MAAMI,GAAU,WAAWW,EAAgBT,CAAqB,EAAE,KAAMU,GAAQ,CACxF,GAAIF,CAAAA,GAAQ,QAIZ,OAAAb,EAAWe,CAAG,EAEPA,CAAA,CACR,EAED,MAAMhB,GAAS,OAAO,IAAIR,CAAE,GAAIgB,CAAO,QAChCS,EAAO,CACN,QAAA,MAAM,mCAAoCA,CAAK,CAAA,CAE3D,GAEMH,CAAM,EAEL,IAAM,CACXD,EAAgB,MAAM,EACtBb,GAAS,QAAQ,CACnB,GACC,CAACG,EAAsBK,EAASF,EAAuBF,CAAQ,CAAC,EAE/Db,EACF,UAAW2B,KAAY,OAAO,KAAK3B,CAAS,EACjCS,GAAA,iBACPkB,EAAS,YAAY,EACpB3B,EAA0F2B,CAAQ,CACrG,EAIJ,OAAQC,EAAA,cAAA,MAAA,CAAK,GAAGpB,EAAO,GAAAP,EAAQ,CACjC"}