"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("react"),O=require("../../contexts/form/form.cjs.js"),P=require("../../hooks/use-event-listener.cjs.js"),C=require("./gift-card.styles.cjs.js");function z({buttonProps:p={id:"rswps-gift-card-button"},callbacks:i,children:h,focus:u,id:o="rswps-gift-card-container",includeInputLabels:d,render:f,style:l,...E}){const[a,v]=r.useState(()=>{}),[R,w]=r.useState(!1),{cardTokenizeResponseReceived:S,payments:b}=O.useForm(),g=r.useRef(null),k=r.useMemo(()=>{const e={includeInputLabels:d,style:l};return Object.keys(e).reduce((t,n)=>(e[n]!==void 0&&(t[n]=e[n]),t),{})},[d,l]),G=async e=>{if(e.stopPropagation(),!a){console.warn("Gift Card button was clicked, but no Gift Card instance was found.");return}w(!0);try{const t=await a?.tokenize();if(t.status==="OK")return await S(t);let n=`Tokenization failed with status: ${t.status}`;if(t?.errors)throw n+=` and errors: ${JSON.stringify(t?.errors)}`,new Error(n);console.warn(n)}catch(t){console.error(t)}finally{w(!1)}};if(r.useEffect(()=>{const e=new AbortController,{signal:t}=e;return(async s=>{const c=await b?.giftCard(k).then(y=>s.aborted?null:(v(y),y));await c?.attach(`#${o}`),u&&await c?.focus(u),s.aborted&&await c?.destroy()})(t),()=>{e.abort()}},[b,o]),i)for(const e of Object.keys(i))a?.addEventListener(e,i[e]);P.useEventListener({listener:G,type:"click",element:g.current,options:{passive:!0}});const m=({isLoading:e,...t})=>{const n="rswp-gift-card-button",s=e||!a||R;return r.createElement(C.PayButton,{...t,"aria-disabled":s,css:t?.css,disabled:s,id:n,ref:g,type:"button"},t?.children??"Pay with Gift Card")};return r.createElement(r.Fragment,null,r.createElement("div",{...E,"data-testid":"rswps-gift-card-container",id:o,style:{minHeight:89}},!a&&r.createElement(C.LoadingCard,null)),typeof f=="function"?f(m):r.createElement(m,{...p},h??"Pay with Gift Card"))}exports.default=z;
//# sourceMappingURL=gift-card.cjs.js.map
