{"version":3,"file":"gift-card.cjs.js","sources":["../../../src/components/gift-card/gift-card.tsx"],"sourcesContent":["// Dependencies\r\nimport { useState, useRef, useMemo, useEffect, JSX } from 'react';\r\nimport type * as Square from '@square/web-sdk';\r\n\r\n// Internals\r\nimport { useForm } from '~/contexts/form';\r\nimport { useEventListener } from '~/hooks/use-event-listener';\r\nimport { LoadingCard, PayButton } from './gift-card.styles';\r\nimport type {\r\n  GiftCardBase,\r\n  GiftCardFunctionChildren,\r\n  GiftCardPayButtonProps,\r\n  GiftCardProps,\r\n  GiftCardWithChildren,\r\n} from './gift-card.types';\r\nimport React from 'react';\r\n\r\n/**\r\n * Renders a Gift Card Input to use in the Square Web Payment SDK, pre-styled to\r\n * meet Square branding guidelines.\r\n *\r\n * **_But with the option to override styles_**\r\n *\r\n * @example\r\n *\r\n * ```tsx\r\n * function App() {\r\n *   return (\r\n *     <SquareForm {...props}>\r\n *       <GiftCard />\r\n *     </SquareForm>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nfunction GiftCard(props: GiftCardBase): JSX.Element;\r\nfunction GiftCard(props: GiftCardFunctionChildren): JSX.Element;\r\nfunction GiftCard(props: GiftCardWithChildren): JSX.Element;\r\nfunction GiftCard({\r\n  buttonProps = {\r\n    id: 'rswps-gift-card-button',\r\n  },\r\n  callbacks,\r\n  children,\r\n  focus,\r\n  id = 'rswps-gift-card-container',\r\n  includeInputLabels,\r\n  render,\r\n  style,\r\n  ...props\r\n}: GiftCardProps) {\r\n  const [giftCard, setGiftCard] = useState<Square.GiftCard | undefined>(() => undefined);\r\n  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);\r\n  const { cardTokenizeResponseReceived, payments } = useForm();\r\n  const buttonRef = useRef<HTMLButtonElement>(null);\r\n\r\n  const options: Square.GiftCardOptions = useMemo(() => {\r\n    const baseOptions = {\r\n      includeInputLabels,\r\n      style,\r\n    };\r\n\r\n    // if a value from options is undefined delete it from the options object\r\n    return Object.keys(baseOptions).reduce((acc: Record<string, unknown>, key) => {\r\n      if (baseOptions[key as keyof typeof baseOptions] !== undefined) {\r\n        acc[key as string] = baseOptions[key as keyof typeof baseOptions];\r\n      }\r\n\r\n      return acc;\r\n    }, {});\r\n  }, [includeInputLabels, style]);\r\n\r\n  /** Tokenizes a GiftCard payment method instance. */\r\n  const handlePayment = async (e: Event) => {\r\n    e.stopPropagation();\r\n\r\n    if (!giftCard) {\r\n      console.warn('Gift Card button was clicked, but no Gift Card instance was found.');\r\n\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      const result = await giftCard?.tokenize();\r\n\r\n      if (result.status === 'OK') {\r\n        const tokenizedResult = await cardTokenizeResponseReceived(result);\r\n        return tokenizedResult;\r\n      }\r\n\r\n      let message = `Tokenization failed with status: ${result.status}`;\r\n      if (result?.errors) {\r\n        message += ` and errors: ${JSON.stringify(result?.errors)}`;\r\n\r\n        throw new Error(message);\r\n      }\r\n\r\n      console.warn(message);\r\n    } catch (error) {\r\n      console.error(error);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const abortController = new AbortController();\r\n    const { signal } = abortController;\r\n\r\n    const start = async (signal: AbortSignal) => {\r\n      const giftCard = await payments?.giftCard(options).then((res) => {\r\n        if (!signal.aborted) {\r\n          setGiftCard(res);\r\n\r\n          return res;\r\n        }\r\n\r\n        return null;\r\n      });\r\n\r\n      await giftCard?.attach(`#${id}`);\r\n      if (focus) {\r\n        await giftCard?.focus(focus);\r\n      }\r\n\r\n      if (signal.aborted) {\r\n        await giftCard?.destroy();\r\n      }\r\n    };\r\n\r\n    start(signal);\r\n\r\n    return () => {\r\n      abortController.abort();\r\n    };\r\n  }, [payments, id]);\r\n\r\n  if (callbacks) {\r\n    for (const callback of Object.keys(callbacks)) {\r\n      giftCard?.addEventListener(\r\n        callback as Square.GiftCardInputEventTypes,\r\n        (callbacks as Record<string, (event: Square.SqEvent<Square.GiftCardInputEvent>) => void>)[callback]\r\n      );\r\n    }\r\n  }\r\n\r\n  useEventListener({\r\n    listener: handlePayment,\r\n    type: 'click',\r\n    element: buttonRef.current,\r\n    options: {\r\n      passive: true,\r\n    },\r\n  });\r\n\r\n  const Button = ({ isLoading, ...props }: GiftCardPayButtonProps) => {\r\n    const id = 'rswp-gift-card-button';\r\n    const disabled = isLoading || !giftCard || isSubmitting;\r\n\r\n    return (\r\n      <PayButton\r\n        {...props}\r\n        aria-disabled={disabled}\r\n        css={props?.css}\r\n        disabled={disabled}\r\n        id={id}\r\n        ref={buttonRef}\r\n        type=\"button\"\r\n      >\r\n        {props?.children ?? 'Pay with Gift Card'}\r\n      </PayButton>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div {...props} data-testid=\"rswps-gift-card-container\" id={id} style={{ minHeight: 89 }}>\r\n        {!giftCard && <LoadingCard />}\r\n      </div>\r\n\r\n      {typeof render === 'function' ? (\r\n        render(Button)\r\n      ) : (\r\n        <Button {...buttonProps}>{children ?? 'Pay with Gift Card'}</Button>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default GiftCard;\r\nexport * from './gift-card.types';\r\n"],"names":["GiftCard","buttonProps","callbacks","children","focus","id","includeInputLabels","render","style","props","giftCard","setGiftCard","useState","isSubmitting","setIsSubmitting","cardTokenizeResponseReceived","payments","useForm","buttonRef","useRef","options","useMemo","baseOptions","acc","key","handlePayment","result","message","error","useEffect","abortController","signal","res","callback","useEventListener","Button","isLoading","disabled","React","PayButton","LoadingCard"],"mappings":"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"}