"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=require("react"),m=require("../../contexts/form/form.cjs.js"),b=require("../../hooks/use-event-listener.cjs.js"),h=require("./apple-pay.styles.cjs.js");function q({id:y="rswps-apple-pay",...d}){const[t,f]=s.useState(()=>{}),{cardTokenizeResponseReceived:w,createPaymentRequest:a,payments:o}=m.useForm(),l=s.useRef(null),P=async r=>{if(r.stopPropagation(),!t){console.warn("Apple Pay button was clicked, but no Apple Pay instance was found.");return}try{const e=await t.tokenize();if(e.status==="OK")return w(e);let n=`Tokenization failed with status: ${e.status}`;if(e?.errors)throw n+=` and errors: ${JSON.stringify(e?.errors)}`,new Error(n);console.warn(n)}catch(e){console.error(e)}};return s.useEffect(()=>{if(!a)throw new Error("`createPaymentRequest()` is required when using digital wallets");const r=new AbortController,{signal:e}=r;return(async u=>{const c=o?.paymentRequest(a);if(!c)throw new Error("`paymentRequest` is required when using digital wallets");try{const i=await o?.applePay(c).then(p=>{if(!u?.aborted)return f(p),p});u.aborted&&await i?.destroy()}catch(i){console.error("Initializing Apple Pay failed",i)}})(e),()=>{r.abort()}},[a,o]),b.useEventListener({listener:P,type:"click",element:l,options:{passive:!0}}),s.createElement(h.ApplePayContainer,{...d,css:{display:t?"block":"none",opacity:t?1:.5,pointerEvents:t?"auto":"none",visibility:t?"visible":"hidden"},id:y,ref:l})}exports.default=q;
//# sourceMappingURL=apple-pay.cjs.js.map
