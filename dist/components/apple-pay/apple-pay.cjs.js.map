{"version":3,"file":"apple-pay.cjs.js","sources":["../../../src/components/apple-pay/apple-pay.tsx"],"sourcesContent":["// Dependencies\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport type * as Square from '@square/web-sdk';\r\n\r\n// Internals\r\nimport { useForm } from '~/contexts/form';\r\nimport { useEventListener } from '~/hooks/use-event-listener';\r\nimport { ApplePayContainer } from './apple-pay.styles';\r\nimport type { ApplePayProps } from './apple-pay.types';\r\nimport React from 'react';\r\n\r\n/**\r\n * Renders a Apple Pay button to use in the Square Web Payment SDK, pre-styled\r\n * to meet Apple Pay's branding guidelines.\r\n *\r\n * **Remember** that you need to set `createPaymentRequest()` in `SquareForm` if\r\n * you going to use this Payment Method\r\n *\r\n * @example\r\n *\r\n * ```tsx\r\n * function App() {\r\n *   return (\r\n *     <SquareForm {...props}>\r\n *       <ApplePay />\r\n *     </SquareForm>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nfunction ApplePay({ id = 'rswps-apple-pay', ...props }: ApplePayProps) {\r\n  const [applePay, setApplePay] = useState<Square.ApplePay | undefined>(() => undefined);\r\n  const { cardTokenizeResponseReceived, createPaymentRequest, payments } = useForm();\r\n  const containerRef = useRef<HTMLDivElement>(null) as React.RefObject<HTMLDivElement>;\r\n\r\n  /**\r\n   * Handle the on click of the Apple Pay button click\r\n   *\r\n   * @param e An event which takes place in the DOM.\r\n   * @returns The data be sended to `cardTokenizeResponseReceived()` function, or an error\r\n   */\r\n  const handlePayment = async (e: Event) => {\r\n    e.stopPropagation();\r\n\r\n    if (!applePay) {\r\n      console.warn('Apple Pay button was clicked, but no Apple Pay instance was found.');\r\n\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await applePay.tokenize();\r\n\r\n      if (result.status === 'OK') {\r\n        return cardTokenizeResponseReceived(result);\r\n      }\r\n\r\n      let message = `Tokenization failed with status: ${result.status}`;\r\n      if (result?.errors) {\r\n        message += ` and errors: ${JSON.stringify(result?.errors)}`;\r\n\r\n        throw new Error(message);\r\n      }\r\n\r\n      console.warn(message);\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!createPaymentRequest) {\r\n      throw new Error('`createPaymentRequest()` is required when using digital wallets');\r\n    }\r\n\r\n    const abortController = new AbortController();\r\n    const { signal } = abortController;\r\n\r\n    const start = async (signal: AbortSignal) => {\r\n      const paymentRequest = payments?.paymentRequest(createPaymentRequest);\r\n\r\n      if (!paymentRequest) {\r\n        throw new Error('`paymentRequest` is required when using digital wallets');\r\n      }\r\n\r\n      try {\r\n        const applePay = await payments?.applePay(paymentRequest).then((res) => {\r\n          if (signal?.aborted) {\r\n            return;\r\n          }\r\n\r\n          setApplePay(res);\r\n\r\n          return res;\r\n        });\r\n\r\n        if (signal.aborted) {\r\n          await applePay?.destroy();\r\n        }\r\n      } catch (error) {\r\n        console.error('Initializing Apple Pay failed', error);\r\n      }\r\n    };\r\n\r\n    start(signal);\r\n\r\n    return () => {\r\n      abortController.abort();\r\n    };\r\n  }, [createPaymentRequest, payments]);\r\n\r\n  useEventListener({\r\n    listener: handlePayment,\r\n    type: 'click',\r\n    element: containerRef,\r\n    options: {\r\n      passive: true,\r\n    },\r\n  });\r\n\r\n  return (\r\n    <ApplePayContainer\r\n      {...props}\r\n      // We need to make this styles to be able to use event listener\r\n      css={{\r\n        display: applePay ? 'block' : 'none',\r\n        opacity: applePay ? 1 : 0.5,\r\n        pointerEvents: applePay ? 'auto' : 'none',\r\n        visibility: applePay ? 'visible' : 'hidden',\r\n      }}\r\n      id={id}\r\n      ref={containerRef}\r\n    ></ApplePayContainer>\r\n  );\r\n}\r\n\r\nexport default ApplePay;\r\nexport * from './apple-pay.types';\r\n"],"names":["ApplePay","id","props","applePay","setApplePay","useState","cardTokenizeResponseReceived","createPaymentRequest","payments","useForm","containerRef","useRef","handlePayment","e","result","message","error","useEffect","abortController","signal","paymentRequest","res","useEventListener","React","ApplePayContainer"],"mappings":"4QA8BA,SAASA,EAAS,CAAE,GAAAC,EAAK,kBAAmB,GAAGC,GAAwB,CACrE,KAAM,CAACC,EAAUC,CAAW,EAAIC,EAAA,SAAsC,IAAM,EAAS,EAC/E,CAAE,6BAAAC,EAA8B,qBAAAC,EAAsB,SAAAC,CAAA,EAAaC,EAAAA,QAAQ,EAC3EC,EAAeC,SAAuB,IAAI,EAQ1CC,EAAgB,MAAOC,GAAa,CAGxC,GAFAA,EAAE,gBAAgB,EAEd,CAACV,EAAU,CACb,QAAQ,KAAK,oEAAoE,EAEjF,MAAA,CAGE,GAAA,CACI,MAAAW,EAAS,MAAMX,EAAS,SAAS,EAEnC,GAAAW,EAAO,SAAW,KACpB,OAAOR,EAA6BQ,CAAM,EAGxC,IAAAC,EAAU,oCAAoCD,EAAO,MAAM,GAC/D,GAAIA,GAAQ,OACV,MAAAC,GAAW,gBAAgB,KAAK,UAAUD,GAAQ,MAAM,CAAC,GAEnD,IAAI,MAAMC,CAAO,EAGzB,QAAQ,KAAKA,CAAO,QACbC,EAAO,CACd,QAAQ,MAAMA,CAAK,CAAA,CAEvB,EAEAC,OAAAA,EAAAA,UAAU,IAAM,CACd,GAAI,CAACV,EACG,MAAA,IAAI,MAAM,iEAAiE,EAG7E,MAAAW,EAAkB,IAAI,gBACtB,CAAE,OAAAC,GAAWD,EA4BnB,OA1Bc,MAAOC,GAAwB,CACrC,MAAAC,EAAiBZ,GAAU,eAAeD,CAAoB,EAEpE,GAAI,CAACa,EACG,MAAA,IAAI,MAAM,yDAAyD,EAGvE,GAAA,CACIjB,MAAAA,EAAW,MAAMK,GAAU,SAASY,CAAc,EAAE,KAAMC,GAAQ,CACtE,GAAIF,CAAAA,GAAQ,QAIZ,OAAAf,EAAYiB,CAAG,EAERA,CAAA,CACR,EAEGF,EAAO,SACT,MAAMhB,GAAU,QAAQ,QAEnBa,EAAO,CACN,QAAA,MAAM,gCAAiCA,CAAK,CAAA,CAExD,GAEMG,CAAM,EAEL,IAAM,CACXD,EAAgB,MAAM,CACxB,CAAA,EACC,CAACX,EAAsBC,CAAQ,CAAC,EAElBc,mBAAA,CACf,SAAUV,EACV,KAAM,QACN,QAASF,EACT,QAAS,CACP,QAAS,EAAA,CACX,CACD,EAGCa,EAAA,cAACC,EAAA,kBAAA,CACE,GAAGtB,EAEJ,IAAK,CACH,QAASC,EAAW,QAAU,OAC9B,QAASA,EAAW,EAAI,GACxB,cAAeA,EAAW,OAAS,OACnC,WAAYA,EAAW,UAAY,QACrC,EACA,GAAAF,EACA,IAAKS,CAAA,CACN,CAEL"}